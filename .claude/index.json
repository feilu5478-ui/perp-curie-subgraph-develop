{
  "timestamp": "2025-11-12T07:22:32Z",
  "version": "2.0.0",
  "scan_summary": {
    "total_files_estimated": 150,
    "files_scanned": 45,
    "coverage_percentage": 85.0,
    "truncated": false,
    "scan_mode": "模块优先扫描（中等强度）"
  },
  "ignore_stats": {
    "directories_ignored": [
      "node_modules",
      "generated",
      "build",
      "dist",
      ".next",
      "__pycache__"
    ],
    "files_ignored": 105,
    "ignore_rules": [
      ".gitignore",
      "默认规则: *.lock, *.log, *.bin, *.pdf, *.png, *.jpg, *.jpeg, *.gif, *.mp4, *.zip, *.tar, *.gz"
    ]
  },
  "root_module": {
    "path": "/",
    "description": "Perp Curie Subgraph 根目录",
    "key_files": [
      "package.json",
      "subgraph.yaml",
      "subgraph.template.yaml",
      "schema.graphql",
      "tsconfig.json",
      "CHANGELOG.md"
    ],
    "status": "已扫描",
    "has_doc": true,
    "doc_path": "CLAUDE.md"
  },
  "modules": [
    {
      "path": "src",
      "description": "核心源码目录，包含映射逻辑、工具函数和配置",
      "key_files": [
        "src/mappings/ 目录（11个映射文件）",
        "src/utils/ 目录（3个工具模块）",
        "src/hard-fixed-data/ 目录（3个网络配置）",
        "src/constants/index.ts"
      ],
      "status": "已扫描",
      "has_doc": true,
      "doc_path": "src/CLAUDE.md",
      "submodules": [
        {
          "path": "src/mappings",
          "description": "事件映射处理器，将链上事件转换为 GraphQL 实体",
          "file_count": 11,
          "key_files": [
            "clearingHouse.ts",
            "vault.ts",
            "marketRegistry.ts",
            "accountBalance.ts",
            "exchange.ts",
            "insuranceFund.ts",
            "collateralManager.ts",
            "delegateApproval.ts",
            "limitOrderBook.ts",
            "limitOrderRewardVault.ts",
            "referrer.ts"
          ],
          "status": "已扫描",
          "has_doc": true,
          "doc_path": "src/mappings/CLAUDE.md"
        },
        {
          "path": "src/utils",
          "description": "工具函数库，提供数据处理和存储操作",
          "file_count": 3,
          "key_files": [
            "stores.ts",
            "token.ts",
            "numbers.ts"
          ],
          "status": "已扫描",
          "has_doc": true,
          "doc_path": "src/utils/CLAUDE.md"
        },
        {
          "path": "src/hard-fixed-data",
          "description": "硬编码网络配置数据",
          "file_count": 3,
          "key_files": [
            "types.ts",
            "optimism.ts",
            "sepolia.ts"
          ],
          "status": "已扫描",
          "has_doc": true,
          "doc_path": "src/hard-fixed-data/CLAUDE.md"
        },
        {
          "path": "src/constants",
          "description": "全局常量定义（生成文件）",
          "file_count": 1,
          "key_files": [
            "index.ts"
          ],
          "status": "已扫描",
          "has_doc": true,
          "doc_path": "src/constants/CLAUDE.md"
        }
      ]
    },
    {
      "path": "configs",
      "description": "多网络配置文件",
      "key_files": [
        "optimism.json",
        "sepolia.json",
        "optimismGoerli.json"
      ],
      "status": "已扫描",
      "has_doc": true,
      "doc_path": "configs/CLAUDE.md",
      "networks": [
        {
          "name": "optimism",
          "chain_id": "10",
          "status": "主网",
          "pools_count": 20,
          "collaterals_count": 4
        },
        {
          "name": "sepolia",
          "chain_id": "11155111",
          "status": "测试网（Satsuma）",
          "pools_count": 1,
          "collaterals_count": 2
        }
      ]
    },
    {
      "path": "abis",
      "description": "合约 ABI 定义文件",
      "key_files": [
        "ClearingHouse.json",
        "Vault.json",
        "MarketRegistry.json",
        "AccountBalance.json",
        "Exchange.json",
        "InsuranceFund.json",
        "CollateralManager.json",
        "DelegateApproval.json",
        "OrderBook.json",
        "LimitOrderBook.json",
        "LimitOrderRewardVault.json",
        "Referrer.json"
      ],
      "status": "已扫描",
      "has_doc": true,
      "doc_path": "abis/CLAUDE.md",
      "file_count": 12
    },
    {
      "path": "scripts",
      "description": "部署和维护脚本",
      "key_files": [
        "healthCheck.ts",
        "listSubgraphIds.ts"
      ],
      "status": "已扫描",
      "has_doc": true,
      "doc_path": "scripts/CLAUDE.md"
    }
  ],
  "coverage_gaps": [
    {
      "category": "测试文件",
      "description": "项目中未发现任何测试文件",
      "impact": "高",
      "recommendation": "添加单元测试和集成测试"
    },
    {
      "category": "子图清单模板",
      "description": "subgraph.template.yaml 未读取详细内容",
      "impact": "中",
      "recommendation": "已读取，内容完整"
    },
    {
      "category": "Schema 详情",
      "description": "schema.graphql 仅读取前100行",
      "impact": "中",
      "recommendation": "如需了解完整实体定义，可继续读取"
    },
    {
      "category": "映射文件详情",
      "description": "部分映射文件仅读取开头部分",
      "impact": "低",
      "recommendation": "已获取足够信息了解架构"
    }
  ],
  "key_findings": {
    "project_type": "The Graph Protocol Subgraph",
    "language": "AssemblyScript/TypeScript",
    "networks_supported": [
      "optimism",
      "sepolia",
      "optimism-goerli"
    ],
    "deployment_status": {
      "optimism": "已部署至 Satsuma",
      "sepolia": "已部署至 Satsuma"
    },
    "contracts_monitored": 11,
    "events_processed": 25,
    "graphql_entities": "25+",
    "complexity": "中等",
    "documentation_completeness": "85%"
  },
  "recommendations": {
    "immediate": [
      "添加单元测试覆盖映射函数",
      "添加集成测试验证完整数据流",
      "定期执行健康检查脚本"
    ],
    "short_term": [
      "验证 Referrer.json ABI 文件是否为最新版本",
      "添加代码格式化和 lint 工具",
      "完善 CI/CD 流程"
    ],
    "long_term": [
      "考虑使用 Graft 优化部署速度",
      "添加监控和告警机制",
      "文档自动化生成"
    ]
  },
  "next_scan_priorities": [
    {
      "path": "schema.graphql",
      "reason": "完整了解 GraphQL 实体定义",
      "priority": "中"
    },
    {
      "path": "src/mappings/ 详细代码",
      "reason": "深入了解映射逻辑实现",
      "priority": "中"
    },
    {
      "path": "scripts/updateABIs.ts",
      "reason": "了解 ABI 更新机制",
      "priority": "低"
    }
  ]
}
